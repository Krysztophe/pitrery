<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>pitrery - Upgrade</title>

    <link rel="stylesheet" href="/css/minimal.css">
    <link rel="stylesheet" href="/css/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
        <script src="/js/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
	<h1>pitrery</h1>
	<p>Point In Time Recovery tools for PostgreSQL</p>

	<nav>
	  <ul>
	    <li><a href="/">home</a></li>
	    <li><a href="downloads.html">downloads</a></li>
	    <li><a href="documentation.html">documentation</a></li>
	    <li><a href="https://github.com/dalibo/pitrery/">source code</a></li>
	  </ul>
	</nav>
      </header>

      <section>
        <h1 id="upgrade-to-15">Upgrade to 1.5</h1>

<h2 id="configuration">Configuration</h2>

<p>The following new configuration variables may be used, here are their
defaults:</p>

<ul>
  <li><code>PGXLOG</code> (empty). Path to put pg_xlog outside of PGDATA when
restoring.</li>
  <li><code>PRE_BACKUP_COMMAND</code> (empty) and <code>POST_BACKUP_COMMAND</code>. Command to
run before and after the base backup.</li>
  <li><code>STORAGE</code> (tar). Storage method, “tar” or “rsync”.</li>
  <li><code>COMPRESS_BIN</code>, <code>COMPRESS_SUFFIX</code> and <code>UNCOMPRESS_BIN</code>. Controls to
tool used to compress archived WAL files.</li>
</ul>

<h2 id="archiving">Archiving</h2>

<p>Compression options are only available in the configuration file,
customizing this forces to use <code>-C</code> option of <code>archive_xlog</code>.</p>

<h1 id="upgrade-to-14">Upgrade to 1.4</h1>

<h2 id="archiving-1">Archiving</h2>

<p>As of 1.4, the archive_xlog.conf files is no longer used to configure
archive_xlog. All parameter are now in pitr.conf.</p>

<p>To upgrade, you need to merge your configuration into a pitr.conf
file. The default one is available in DOCDIR
(/usr/local/share/doc/pitrery by default), comments should be enough
to help you reconfigure archive_xlog.</p>

<p>The archive_command should be updated to have archive_xlog search for
the configuration file, -C option accept the basename of the
configuration file name and searches in the configuration directory, a
full path is also accepted:</p>

<pre><code>archive_command = 'archive_xlog -C mypitr %p'
</code></pre>

<h1 id="upgrade-to-13">Upgrade to 1.3</h1>

<h2 id="archiving-2">Archiving</h2>

<p>As of 1.3, pitrery no longer archive more than one file. Thus
archive_nodes.conf file has been removed. The archive_xlog script now
archives only one file.</p>

<p>If you are archiving more than one time, you have to chain archiving
in the archive_command parameter of postgresql.conf:</p>

<pre><code>archive_command = 'archive_xlog -C archive_xlog %p &amp;&amp; rsync -az %p standby:/path/to/archives/%f'
</code></pre>

<p>Of course you can chain archive_xlog to archive multiple times.</p>

<h2 id="backup-and-restore">Backup and restore</h2>

<p>As of 1.3, the best backup is found by storing the stop time of the
backup as an offset from the Unix Epoch in the backup_timestamp file
inside each backup directory. The files can be created from the
backup_label files using this shell script:</p>

<pre><code>BACKUP_DIR=/path/to/backup/dir
LABEL=pitr

for x in ${BACKUP_DIR}/${LABEL}/[0-9]*/backup_label; do
    psql -At -c "select extract(epoch from timestamp with time zone '`awk '/^STOP TIME:/ { print $3" "$4" "$5 }' $x`');" &gt; `dirname $x`/backup_timestamp
done
</code></pre>




      </section>

      <footer>
	<p>Copyright &copy; 2011-2013 Nicolas Thauvin.</p>
	<p>Sponsored by <a href="http://dalibo.com">Dalibo</a>, developed and maintained by <a href="http://orgrim.net/">Nicolas Thauvin</a></p>
	<p><small>Theme based on minimal by <a href="https://github.com/orderedlist">orderedlist</a> licencsed under CC-BY-SA 3.0 Unported</small></p>
      </footer>
    </div> <!-- /container -->
    <script src="/js/scale.fix.js"></script>
  </body>
</html>
